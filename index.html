<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Test des Temp√©raments</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" defer></script>
  <style>
    :root{
      --bg:#f9f9f9; --fg:#111; --muted:#666; --card:#ffffff; --ring:#dcdcdc; --ok:#2e7d32;
      --accent:#0ea5e9; --btn:#f0f0f0; --btn-hover:#c7f9cc;
    }
    html,body{height:100%}
    body{
      font-family: Arial, Helvetica, sans-serif; margin:0; color:var(--fg);
      background:linear-gradient(#f1f5f9,#eef2ff) fixed; text-align:center;
    }
    .container{
      max-width: 900px; margin: 48px auto; padding: 30px; background:var(--card);
      border-radius: 14px; box-shadow: 0 10px 30px rgba(0,0,0,.08);
    }
    h1{margin: 0 0 10px}
    p.lead{margin:0;color:var(--muted)}
    .hidden{display:none}

    .input-row{margin-top:18px;display:flex;gap:12px;justify-content:center;flex-wrap:wrap}
    input[type="text"]{
      font-size:20px;padding:12px 14px;border-radius:10px;border:1px solid var(--ring);
      width:min(520px,90%); text-align:center;
    }
    #startButton{
      background: #ffeb3b; border: none; padding: 14px 22px; border-radius: 10px;
      font-size: 20px; cursor: pointer;
    }

    .progress-bar{width:100%; background:#ddd; height: 26px; border-radius: 8px; margin-top: 18px; overflow:hidden}
    .progress{height:100%; width:0%; background: linear-gradient(90deg,#22c55e,#0ea5e9)}

    .question-container{margin-top:28px}
    .question-title{font-size:22px;margin:0 0 10px}

    .answers{margin-top:16px}
    .answers button{
      display:block; width:min(90%,680px); margin: 10px auto; padding: 14px 16px;
      font-size: 20px; cursor: pointer; border: none; background: var(--btn);
      border-radius: 10px; transition: .2s;
    }
    .answers button:hover{ background: var(--btn-hover) }

    #downloadPDF{
      display:block; width:min(90%,420px); margin: 16px auto; padding: 14px 16px;
      font-size: 20px; cursor: pointer; border: none; background:#e5e7eb;
      border-radius: 10px; transition:.2s;
    }
    #downloadPDF:hover{ background:#d1d5db }

    .result-line{margin:6px 0}
    .badge{display:inline-block; padding:4px 10px; border-radius:999px; background:#eef2ff; border:1px solid #c7d2fe; font-size:14px}
  </style>
</head>
<body>

  <!-- PAGE ACCUEIL -->
  <div id="pageAccueil" class="container">
    <h1>Test des Temp√©raments</h1>
    <p class="lead">Choisissez l‚Äôadjectif qui vous correspond le mieux √† chaque question.</p>
    <div class="input-row">
      <input type="text" id="nomUtilisateur" placeholder="Votre nom" />
      <button id="startButton" type="button">Suivant</button>
    </div>
  </div>

  <!-- PAGE TEST -->
  <div id="testContainer" class="container hidden">
    <div class="progress-bar"><div id="progress" class="progress"></div></div>

    <div id="question-container" class="question-container">
      <h2 id="question-text" class="question-title"></h2>
      <div id="answers" class="answers"></div>
    </div>

    <div id="results" class="hidden">
      <h2>R√©sultats</h2>
      <p id="result-header"></p>
      <div id="result-text"></div>
      <button id="downloadPDF" type="button">üìÑ T√©l√©charger en PDF</button>
    </div>
  </div>

  <script>
  (function(){
    // --------------------------
    // Donn√©es
    // --------------------------
    const questions = [
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Expressif", "Aventurier", "Analytique", "Souple"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Enjou√©", "Persuasif", "Persistant", "Paisible"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Sociable", "D√©termin√©", "Esprit de sacrifice", "Soumis"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Convaincant", "Esprit de comp√©tition", "Pr√©venant", "Calme"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Rafra√Æchissant", "D√©brouillard", "Respectueux", "R√©serv√©"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Spirituel", "Ind√©pendant", "Sensible", "Satisfait"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Promoteur", "Positif", "Organis√©", "Patient"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Spontan√©", "Assur√©", "M√©thodique", "Timide"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Optimiste", "Ouvert", "Disciplin√©", "Serviable"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Amusant", "Energique", "Fid√®le", "Amical"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Charmant", "Audacieux", "Minutieux", "Diplomate"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Joyeux", "R√©solu", "Cultiv√©", "Constant"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Source d'inspiration", "Ind√©pendant", "Id√©aliste", "Inoffensif"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["D√©monstratif", "D√©cisif", "Profond", "Esprit caustique"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Liant", "Actif", "Musical", "M√©diateur"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Bavard", "Tenace", "Attentionn√©", "Tol√©rant"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Enthousiaste", "Leader", "Loyal", "Aime √©couter"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Mignon", "Meneur", "Aime les graphiques", "Content de soi"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Populaire", "Cr√©ateur", "Perfectionniste", "Laxiste"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Dynamique", "Intr√©pide", "Bien √©lev√©", "Equilibr√©"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Arrogant", "Autoritaire", "Pudique", "D√©concert√©"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Indisciplin√©", "Incompr√©hensif", "Impitoyable", "Sans enthousiasme"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["R√©p√©titif", "R√©sistant", "Rancunier", "Renfrogn√©"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Distrait", "Franc", "Tatillon", "Peureux"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Interrompt", "Impatient", "Anxieux", "Ind√©cis"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Impr√©visible", "Malveillant", "Impopulaire", "Autonome"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Agit au hasard", "Ent√™t√©", "Exigeant", "H√©sitant"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Complaisant", "Orgueilleux", "Pessimiste", "Ordinaire"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Soupe au lait", "Raisonner", "Isol√©", "D√©s≈ìuvr√©"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Na√Øf", "Effront√©", "Attitude n√©gative", "Nonchalant"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Aime √™tre reconnu", "Bourreau de travail", "Renferm√©", "Inquiet"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Loquace", "Manque de tact", "Exc√®s de sensibilit√©", "G√™n√©"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["D√©sorganis√©", "Dominateur", "D√©prim√©", "Incertain"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Inconsistant", "Intol√©rant", "Introverti", "Indiff√©rent"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["D√©sordonn√©", "Manipulateur", "Lunatique", "R√¢leur"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Cr√¢neur", "T√™tu", "Sceptique", "Lent"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Bruyant", "Fait l'important", "Solitaire", "Paresseux"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["√âcervel√©", "Emport√©", "M√©fiant", "Apathique"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Agit√©", "Imprudent", "Vindicatif", "D√©sint√©ress√©"] },
      { text: "Choisissez l'adjectif qui correspond le mieux √† votre personnalit√© :", answers: ["Inconstant", "Rus√©", "Critique", "Pr√¥ne les compromis"] }
    ];

    // Ordre de r√©f√©rence des temp√©raments = indices d'origine (0..3)
    // 0 ‚Üí Sanguin, 1 ‚Üí Bilieux, 2 ‚Üí M√©lancolique, 3 ‚Üí Flegmatique
    const TEMPERAMENTS = ["sanguin","bilieux","m√©lancolique","flegmatique"];

    // √âtat
    let nomUtilisateur = "";
    let currentQuestion = 0;
    let results = { sanguin:0, bilieux:0, m√©lancolique:0, flegmatique:0 };

    // S√©lecteurs
    const pageAccueil = document.getElementById("pageAccueil");
    const startButton = document.getElementById("startButton");
    const testContainer = document.getElementById("testContainer");
    const progressEl = document.getElementById("progress");
    const questionText = document.getElementById("question-text");
    const answersEl = document.getElementById("answers");
    const questionContainer = document.getElementById("question-container");
    const resultsWrap = document.getElementById("results");
    const resultHeader = document.getElementById("result-header");
    const resultText = document.getElementById("result-text");
    const pdfBtn = document.getElementById("downloadPDF");

    // Utils
    function shuffle(array){
      for(let i=array.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [array[i],array[j]]=[array[j],array[i]];
      }
      return array;
    }

    // Construit des options { label, type } puis m√©lange l‚Äôordre
    function buildShuffledOptions(q){
      const opts = q.answers.map((label, idxOrig)=>({
        label,
        type: TEMPERAMENTS[idxOrig]  // index 0..3 ‚Üí temp√©rament
      }));
      return shuffle(opts);
    }

    function updateProgress(){
      const width = ((currentQuestion + 1) / questions.length) * 100;
      progressEl.style.width = width + "%";
    }

    function renderQuestion(){
      if(currentQuestion >= questions.length){
        renderResults();
        return;
      }
      const q = questions[currentQuestion];
      questionText.textContent = q.text;
      answersEl.innerHTML = "";

      const options = buildShuffledOptions(q);
      options.forEach(opt=>{
        const btn = document.createElement("button");
        btn.type = "button";
        btn.textContent = opt.label;
        btn.addEventListener("click", ()=> registerAnswer(opt.type));
        answersEl.appendChild(btn);
      });

      updateProgress();
    }

    function registerAnswer(type){
      if(type === "sanguin") results.sanguin++;
      else if(type === "bilieux") results.bilieux++;
      else if(type === "m√©lancolique") results.m√©lancolique++;
      else if(type === "flegmatique") results.flegmatique++;

      currentQuestion++;
      renderQuestion();
    }

    function renderResults(){
      questionContainer.classList.add("hidden");
      resultsWrap.classList.remove("hidden");

      const total = results.sanguin + results.bilieux + results.m√©lancolique + results.flegmatique;
      const p = (n)=> total ? Math.round((n/total)*100) : 0;

      resultHeader.innerHTML = `<span class="badge">Participant</span> <strong>${nomUtilisateur || "Anonyme"}</strong>`;
      resultText.innerHTML = `
        <p class="result-line"><strong>Sanguin</strong> : ${results.sanguin} (${p(results.sanguin)}%)</p>
        <p class="result-line"><strong>Bilieux</strong> : ${results.bilieux} (${p(results.bilieux)}%)</p>
        <p class="result-line"><strong>M√©lancolique</strong> : ${results.m√©lancolique} (${p(results.m√©lancolique)}%)</p>
        <p class="result-line"><strong>Flegmatique</strong> : ${results.flegmatique} (${p(results.flegmatique)}%)</p>
      `;
    }

    async function generatePDF(){
      const { jsPDF } = window.jspdf || {};
      if(!jsPDF){ alert("Biblioth√®que jsPDF non charg√©e."); return; }

      const doc = new jsPDF();
      const total = results.sanguin + results.bilieux + results.m√©lancolique + results.flegmatique;
      const pct = (n)=> total ? Math.round((n/total)*100) : 0;

      doc.setFont("helvetica", "bold");
      doc.setFontSize(18);
      doc.text("R√©sultats du Test des Temp√©raments", 20, 20);

      doc.setFont("helvetica", "normal");
      doc.setFontSize(14);
      doc.text(`Nom : ${nomUtilisateur || "Anonyme"}`, 20, 40);
      doc.text(`Sanguin : ${results.sanguin} (${pct(results.sanguin)}%)`, 20, 60);
      doc.text(`Bilieux : ${results.bilieux} (${pct(results.bilieux)}%)`, 20, 78);
      doc.text(`M√©lancolique : ${results.m√©lancolique} (${pct(results.m√©lancolique)}%)`, 20, 96);
      doc.text(`Flegmatique : ${results.flegmatique} (${pct(results.flegmatique)}%)`, 20, 114);

      const safeName = (nomUtilisateur || "Anonyme").replace(/[^\p{L}\p{N}_-]+/gu,"_").slice(0,40);
      doc.save(`Resultats_${safeName}.pdf`);
    }

    // Start
    startButton.addEventListener("click", ()=>{
      const input = document.getElementById("nomUtilisateur");
      nomUtilisateur = (input.value || "").trim();
      if(!nomUtilisateur){
        alert("Veuillez entrer votre nom."); return;
      }
      pageAccueil.classList.add("hidden");
      testContainer.classList.remove("hidden");
      renderQuestion();
    });

    pdfBtn.addEventListener("click", generatePDF);
  })();
  </script>
</body>
</html>
